@model Sharmila_Textile_WebApp.ViewModel.SummaryViewModel
@{
    ViewData["Title"] = "Summary Detail View";
}


<nav class="navbar navbar-expand-lg navbar-transparent navbar-absolute fixed-top">
    <div class="container-fluid">
        <div class="navbar-wrapper">
            <nav aria-label="breadcrumb" role="navigation">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item active"><a asp-action="SummaryListView">Summary</a></li>
                    <li class="breadcrumb-item active" aria-current="page">@ViewBag.breadCumValue</li>
                </ol>
            </nav>
        </div>
        <button class="navbar-toggler" type="button" data-toggle="collapse" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
            <span class="navbar-toggler-icon icon-bar"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-end">
            <form class="navbar-form">
                <div class="input-group no-border">
                    <input type="text" value="" class="form-control" placeholder="Search...">
                    <button type="button" class="btn btn-white btn-round btn-just-icon">
                        <i class="material-icons">search</i>
                        <div class="ripple-container"></div>
                    </button>
                </div>
            </form>
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="material-icons">notifications</i>
                        @* <span class="notification">5</span> *@
                        <p class="d-lg-none d-md-block">
                            Some Actions
                        </p>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownMenuLink">
                        <a class="dropdown-item" href="#">Mike John responded to your email</a>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" href="#pablo" id="navbarDropdownProfile" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="material-icons">person</i>
                        <p class="d-lg-none d-md-block">
                            Account
                        </p>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdownProfile">
                        <a class="dropdown-item" href="#">Profile</a>
                        <a class="dropdown-item" href="#">Settings</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Log out</a>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <hr />
            </div>
        </div>

        <div class="row">
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="card card-chart">
                    <div class="card-header card-header-success p-1 pt-2 pl-2">
                        <h5 class="card-title">Collection</h5>
                    </div>
                    <div class="card-body">
                        <div class="row justify-content-between">
                            <div class="col-auto">
                                <h5 class="font-weight-bold">Total Collection</h5>
                            </div>
                            <div class="col-auto">
                                <h5 id="lblTotalCollection">@Model.TotalCollection</h5>
                            </div>
                        </div>
                        <div class="row justify-content-between">
                            <div class="col-auto font-weight-bold">
                                <h5 class="font-weight-bold">Accountable Collection</h5>
                            </div>
                            <div class="col-auto">
                                <h5 id="lblAccountableCollection">@Model.AccountableCollection</h5>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-print-none">
                        <div class="stats">
                            <a target="_blank" asp-controller="Collection" asp-action="CollectionListView" asp-route-date="@Model.Date" class="text-primary">
                                <i class="fa fa-external-link mr-2"></i>View Collection
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="card card-chart">
                    <div class="card-header card-header-success p-1 pt-2 pl-2">
                        <h5 class="card-title">Payment</h5>
                    </div>
                    <div class="card-body">
                        <div class="row justify-content-between">
                            <div class="col-auto">
                                <h5 class="font-weight-bold">Total Payment</h5>
                            </div>
                            <div class="col-auto">
                                <h5 id="lblTotalPayment">@Model.TotalPayment</h5>
                            </div>
                        </div>
                        <div class="row justify-content-between">
                            <div class="col-auto font-weight-bold">
                                <h5 class="font-weight-bold">Accountable Payment</h5>
                            </div>
                            <div class="col-auto">
                                <h5 id="lblAccountablePayment">@Model.AccountablePayment</h5>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-print-none">
                        <div class="stats">
                            <a target="_blank" asp-controller="SupplierPayment" asp-action="PaymentListView" asp-route-date="@Model.Date" class="text-primary">
                                <i class="fa fa-external-link mr-2"></i>View Payment
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="card card-chart">
                    <div class="card-header card-header-success p-1 pt-2 pl-2">
                        <h5 class="card-title">Expense</h5>
                    </div>
                    <div class="card-body">
                        <div class="row justify-content-between">
                            <div class="col-auto">
                                <h5 class="font-weight-bold">Total Expense</h5>
                            </div>
                            <div class="col-auto">
                                <h5 id="lblTotalExpense">@Model.TotalExpense</h5>
                            </div>
                        </div>
                        <div class="row justify-content-between">
                            <div class="col-auto font-weight-bold">
                                <h5 class="font-weight-bold">Accountable Expense</h5>
                            </div>
                            <div class="col-auto">
                                <h5 id="lblAccountableExpense">@Model.AccountableExpense</h5>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-print-none">
                        <div class="stats">
                            <a target="_blank" asp-controller="Expense" asp-action="ExpenseListView" asp-route-date="@Model.Date" class="text-primary">
                                <i class="fa fa-external-link mr-2"></i>View Expenses
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 col-sm-6">
                <div class="card card-chart">
                    <div class="card-header card-header-success p-1 pt-2 pl-2">
                        <h5 class="card-title">Bank Deposit</h5>
                    </div>
                    <div class="card-body">
                        <div class="row justify-content-between">
                            <div class="col-auto">
                                <h5 class="font-weight-bold">Total Bank Deposit</h5>
                            </div>
                            <div class="col-auto">
                                <h5 id="lblTotalBankDeposit">@Model.TotalBankDeposit</h5>
                            </div>
                        </div>
                        <div class="row justify-content-between">
                            <div class="col-auto font-weight-bold">
                                <h5 class="font-weight-bold">Accountable Bank Deposit</h5>
                            </div>
                            <div class="col-auto">
                                <h5 id="lblAccountableBankDeposit">@Model.AccountableBankDeposit</h5>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-print-none">
                        <div class="stats">
                            <a target="_blank" asp-controller="BankDeposit" asp-action="BankDepositListView" asp-route-date="@Model.Date" class="text-primary">
                                <i class="fa fa-external-link mr-2"></i>View Bank Deposit
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row d-print-block d-none">
            <div class="col">
                <hr/>
            </div>
            </div>

            <div class="row">
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="card card-chart">
                        <div class="card-header card-header-rose p-1 pt-2 pl-2">
                            <h5 class="card-title">Daily Business</h5>
                        </div>
                        <div class="card-body">
                            <div class="row justify-content-around">
                                <div class="col-6">
                                    <div class="form-group bmd-form-group">
                                        <label>BTT Bill</label>
                                        <input type="number" class="form-control number-validation" id="txtBttBill" asp-for="BttBills">
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group bmd-form-group">
                                        <label>Normal Bill</label>
                                        <input type="number" class="form-control number-validation" id="txtNormalBill" asp-for="NormalBills">
                                    </div>
                                </div>
                            </div>
                            <div class="row ml-0 mr-0 pt-2 pb-2">
                                <div class="col-6 text-right font-weight-bold">
                                    <h5 class="font-weight-bold mb-0">Total Amount</h5>
                                </div>
                                <div class="col-6 text-left">
                                    <h5 class="mb-0" id="lblTotalAmount">0.0</h5>
                                </div>
                            </div>
                            <div class="row ml-0 mr-0 pt-2 pb-2">
                                <div class="col-6 text-right font-weight-bold">
                                    <h5 class="font-weight-bold mb-0">Summary Total</h5>
                                </div>
                                <div class="col-6 text-left">
                                    <h5 class="mb-0" id="lblSummaryTotal">0.0</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6">
                    <div class="card card-chart">
                        <div class="card-header card-header-rose p-1 pt-2 pl-2">
                            <h5 class="card-title">Cash/Cheque Remaining</h5>
                        </div>
                        <div class="card-body">
                            <div class="row justify-content-around">
                                <div class="col-6">
                                    <div class="form-group bmd-form-group">
                                        <label>Select a Date</label>
                                        <input type="date" class="form-control" id="dtpDate" value="@if (ViewBag.IsUpdate != "true") { @DateTime.Now.ToString("yyyy-MM-dd"); } else { @Model.Date.ToString("yyyy-MM-dd"); }">
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-group bmd-form-group">
                                        <label>Cash Balance</label>
                                        <input type="number" class="form-control number-validation" id="txtCashBalance" asp-for="CashBalance">
                                    </div>
                                </div>
                            </div>
                            <div class="row ml-0 mr-0 mb-5 pt-2 h-100">
                                <div class="col-6 text-right font-weight-bold">
                                    <h5 class="font-weight-bold mb-0">Cheque Balance</h5>
                                </div>
                                <div class="col-6 text-left">
                                    <h5 class="mb-0" id="lblChequeBalance">@Model.ChequeBalance</h5>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row d-print-none">
                <div class="col">
                    <hr />
                </div>
            </div>

            <!-------------------------------------------  Button Section ----------------------------------------->
            <div class="row justify-content-end">
                <div class="col-auto form-inline" id="progressBar">
                    <img src="~/img/progress.gif" style="max-height: 41px;" class="mr-3" />
                    <h5 class="align-bottom mb-0">Please Wait....</h5>
                </div>
                <div class="col-auto">
                    <button id="btnPrint" class="btn btn-primary d-print-none btn-success"><i class="material-icons mr-2">print</i>Print</button>

                    @if (ViewBag.IsUpdate == "true") {
                        <button type="button" class="btn btn-danger d-print-none" onclick="deleteConfirmation()">Delete</button>
                    }
                    else {
                        <button type="button" class="btn btn-primary d-print-none" onclick="getFieldDetails()">Submit</button>
                    }
                </div>
            </div>
        </div>
        <pre id="txtJson" style=" font-size: 20px; font-weight: bold;"></pre>

    </div>


<script>
    var model = {};
    var IsUpdate = @ViewBag.IsUpdate;
    var bttBill = 0;
    var normalBill = 0;
    var totalAmount = 0;
    var summaryTotal = 0;
    var totalCollection = parseFloat($('#lblTotalCollection').text());
    var accountableCollection = parseFloat($('#lblAccountableCollection').text());
    var totalPayment = parseFloat($('#lblTotalPayment').text());
    var accountablePayment = parseFloat($('#lblAccountablePayment').text());
    var totalExpense = parseFloat($('#lblTotalExpense').text());
    var accountableExpense = parseFloat($('#lblAccountableExpense').text());
    var totalBankDeposit = parseFloat($('#lblTotalBankDeposit').text());
    var accountableBankDeposit = parseFloat($('#lblAccountableBankDeposit').text());

    $('#progressBar').hide();

    $('#btnPrint').click(function(){
        window.print();
        return false;
    });

    $(".number-validation").keyup(function () {
        if ($(this).val().length === 0) {
            $(this).val("0");
        };
        calculateGrandTotal();
    });
    calculateGrandTotal();


    function calculateGrandTotal() {

        bttBill = parseFloat($('#txtBttBill').val());
        normalBill = parseFloat($('#txtNormalBill').val());
        totalAmount = bttBill + normalBill;

        $('#lblTotalAmount').text(totalAmount);

        summaryTotal = totalAmount + totalCollection - totalPayment - totalExpense - totalBankDeposit;
        $('#lblSummaryTotal').text(summaryTotal);

    }

    function getFieldDetails() {

        model = {
            "BttBills": bttBill,
            "NormalBills": normalBill,
            "TotalAmount": totalAmount,
            "TotalCollection": totalCollection,
            "AccountableCollection": parseFloat($('#lblAccountableCollection').text()),
            "TotalPayment": totalPayment,
            "AccountablePayment": parseFloat($('#lblAccountablePayment').text()),
            "TotalExpense": totalExpense,
            "AccountableExpense": parseFloat($('#lblAccountableExpense').text()),
            "TotalBankDeposit": totalBankDeposit,
            "AccountableBankDeposit": parseFloat($('#lblAccountableBankDeposit').text()),
            "SummaryTotal": summaryTotal,
            "CashBalance": parseFloat($('#txtCashBalance').val()),
            "ChequeBalance": parseFloat($('#lblChequeBalance').text()),
            "Date": $('#dtpDate').val(), 
            "IsUpdate":false
        };

        $('#txtJson').html(JSON.stringify(model, undefined, 4));
        SaveChanges('Create');
    }

    function SaveChanges(type) {
        $('#progressBar').show();
        $.ajax({
            url: localStorage.apiLink + "api/Summary/" + type,
            type: 'POST',
            data: JSON.stringify(model),
            contentType: 'application/json',
            success: function (data, textStatus, xhr) {
                $('#progressBar').hide();
                if (data === true) {

                    Swal.fire({
                        title: 'Success',
                        text: "Changes Saved Successfully!",
                        icon: 'success',
                        showCancelButton: false,
                        confirmButtonColor: '#3085d6',
                        confirmButtonText: 'OK!'
                    }).then((result) => {
                        if (result.value) {
                            window.location.replace(localStorage.apiLink + "Summary/SummaryListView");
                        }
                    });
                } else {
                    Swal.fire(
                        'Oops...',
                        'Something went wrong!',
                        'error'
                    );
                }
            },
            error: function (xhr, textStatus, errorThrown) {

            }
        });
    }

    function deleteConfirmation() {
        Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.value) {
                deleteRequest();
            }
        });
    }

    function deleteRequest() {
        $.ajax({
            url: localStorage.apiLink + "api/Summary/Delete/" + @Model.SummaryId,
            type: 'get',
            contentType: 'application/json',
            success: function (data, textStatus, xhr) {
                if (data === true) {
                    window.location.replace(localStorage.apiLink + "Summary/SummaryListView");
                }
            },
            error: function (xhr, textStatus, errorThrown) {
                console.log('Error in Operation');
            }
        });
    }


</script>

